services:
  openresty:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./examples/openresty/nginx.conf:/etc/nginx/conf.d/default.conf
      - .:/opt/opentelemetry-lua
    depends_on:
      - otel-collector
      - test-server
    networks:
      - opentelemetry-lua
    ports:
      - 80:80
  jaeger:
    image: jaegertracing/all-in-one
    ports:
      - 26686:16686
      - 4319-4320:4317-4318
    networks:
      - opentelemetry-lua
  otel-collector:
    image: otel/opentelemetry-collector-contrib-dev:latest
    command: [ "--config=/etc/otel-collector-config.yaml" ]
    ports:
      - 4317:4317
    volumes:
      - ./otel-collector-config.yaml:/etc/otel-collector-config.yaml
    networks:
      - opentelemetry-lua
  test-server:
    build:
      context: ./examples/server
    ports:
      - 10080:80
    depends_on:
      - otel-collector
    networks:
      - opentelemetry-lua
  test-client:
    build:
      context: ./examples/client
    environment:
      - PROXY_ENDPOINT=${PROXY_ENDPOINT}
    networks:
      - opentelemetry-lua
  utils:
    build:
      context: ./utils
    volumes:
      - .:/opt/opentelemetry-lua
networks:
  opentelemetry-lua:
